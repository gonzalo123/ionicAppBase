/*! ionic App base v1.0.0 by Gonzalo Ayuso(gonzalo123@gmail.com) - http://github.com/gonzalo123/ionicAppBase - MIT License */

!function(a){a.module("gMain",["main.tpls","ionic","angular-locker"]).provider("privateState",function(){this.$get=function(){return{}},this.get=function(b){return a.extend({resolve:{user:function(a){return a.init()}}},b)}}).service("UserService",["$q","$state","$timeout","locker","http","conf",function(a,b,c,d,e,f){var g=!1,h={};return{init:function(){var b=a.defer();return g===!1&&(h=d.get("user"),g=!0),h&&h.hasOwnProperty("token")&&e.setToken(h.token),c(function(){h?b.resolve(h):b.reject({error:"noUser"})},100),b.promise},login:function(b,c){return e.post("/auth/validateCredentials",{user:b,password:c}).success(function(c){return c.status?(h={user:b,token:c.token,version:f.version},e.setToken(h.token),d.put("user",h),h):a.reject(c)}).error(function(b){return a.reject(b)})},logout:function(){h={},e.setToken(void 0),d.forget("user"),b.go("_login",{})}}}]).factory("_",["Lang","MainLang","conf",function(a,b,c){return function(d){return a.hasOwnProperty(d)?a[d][c.lang]||d:b.hasOwnProperty(d)?b[d][c.lang]||d:d}}]).factory("alert",["$ionicPopup",function(a){return function(b,c){a.alert({title:c,template:b})}}]).factory("confirm",["$ionicPopup",function(a){return function(b,c,d,e){var f=a.confirm({title:c,template:b});f.then(function(a){a?d&&d():e&&e()})}}]).factory("http",["$http","$state","$ionicLoading","$rootScope","_","alert","conf",function(b,c,d,e,f,g,h){var i,j=h.host,k=function(a,b){d.hide(),206==b&&e.$emit("wrong.regid")},l=function(a,b){switch(d.hide(),b){case 403:g(f("tokenError")),e.$emit("logout")}},m=function(b){return b=b||{},a.extend({_token:i,_version:h.version,_unique:(new Date).getTime()},b)},n={setToken:function(a){i=a},getBackground:function(a,b){return n.get(a,b,!0)},postBackground:function(a,b){return n.post(a,b,!0)},get:function(a,c,e){return e||d.show({template:"<ion-spinner></ion-spinner>"}),c=m(c),b.get(j+a,{params:c}).success(k).error(l)},post:function(a,c,e){return e||d.show({template:"<ion-spinner></ion-spinner>"}),c=m(c),b.post(j+a,c).success(k).error(l)}};return n}]).filter("_",["_",function(a){return function(b){return a(b)}}]).value("MainLang",{"Not valid credentials":{en:"Not valid authentication. Please insert again your credentials",es:"credenciales de acceso no válidas. Por favor inténtelo de nuevo"},"Please Upgrade":{en:"You don't have the correct version version of the APP. Please upgrade.",es:"No tiene la última versión de la aplicación. Por favor actualicela"},Upgrade:{en:"Upgrade",es:"Actualizar"},Login:{en:"Login",es:"Login"},Logout:{en:"Logout",es:"Salir"},"Are you sure?":{en:"Are you sure?",es:"¿Está seguro?"},Username:{en:"Username",es:"Usuario"},Password:{en:"Password",es:"Contraseña"},tokenError:{en:"There's a problem with your credentials. Please login again.",es:"Ha existido un problema con sus credenciales de acceso. Por favor autentifíquese de nuevo.   "},"User blocked":{en:"Too many wrong tries. Your user is blocked. Please try again in a couple of minutes.",es:"Demasiados intentos erróneos. Su usuario se encuentra bloqueado. Intentelo de nuevo en un par de minutos."},Close:{en:"Close",es:"Cerrar"}}).run(["$rootScope","$ionicPlatform","$state","UserService",function(a,b,c,d){b.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),a.$on("logout",function(){d.logout()}),a.$on("$stateChangeError",function(a,b,d,e,f,g){if(g)switch(g.error){case"noUser":c.go("_login",{})}})})}]).config(["$stateProvider","$httpProvider","lockerProvider",function(a,b,c){c.setDefaultDriver("local").setDefaultNamespace("gMobile").setSeparator(".").setEventsEnabled(!1),a.state("_login",{url:"/login",templateUrl:"_templates/login.html",controller:"LoginController",data:{isPublic:!0}})}]).controller("LoginController",["$scope","$state","UserService","alert","_",function(a,b,c,d,e){var f=function(){a.user={username:"",password:""}};f(),a.doLoginAction=function(){""!==a.user.username&&""!==a.user.password&&c.login(a.user.username,a.user.password).success(function(a){f(),a.status===!1?d(e(a.message)):b.go("home",{})})}}]),a.module("main.tpls",[]).run(["$templateCache",function(a){a.put("_templates/login.html",'<ion-view title="{{\'Login\'| _ }}"  hide-back-button="true">    <div class="bar bar-header bar-positive">        <div class="title">RIS</div>    </div>    <ion-content padding="true" class="has-header">        <form>            <div class="list">                <label class="item item-input item-floating-label">                    <span class="input-label">{{\'Username\'| _ }}</span>                    <input ng-model="user.username" type="text" placeholder="{{\'Username\'| _ }}" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">                </label>                <label class="item item-input item-floating-label">                    <span class="input-label">{{\'Password\'| _ }}</span>                    <input ng-model="user.password" type="password" placeholder="{{\'Password\'| _ }}" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">                </label>            </div>            <div class="spacer" style="height: 40px;"></div>                <a  ng-click="doLoginAction()"  class="button button-stable button-block">{{\'Login\'| _ }}</a>        </form>    </ion-content></ion-view>')}])}(angular);
//# sourceMappingURL=main.min.js.map